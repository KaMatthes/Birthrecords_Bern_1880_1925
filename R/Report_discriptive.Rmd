---
title: "Report Analysis Birthweight"
output:
  html_document:
    toc: yes
    toc_float: yes
    toc_depth: 3
    number_sections: yes
  # word_document:
  #   toc: yes
  #   toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r global_options, include=FALSE,message=FALSE}
used.data <- databern %>%
       filter(multiple==0) %>%
       filter(!(weight < 1500)) %>%
       filter(!(matage > 50))  %>%
       filter(!(matage <14)) %>%
  mutate(
   Weight_quan = as.character(cut(weight, breaks=quantile(weight,probs=c(0,0.1,0.9,1)),include.lowest = TRUE)),
   Weight_cat_quan  = Weight_quan,
   Weight_cat_quan  = replace( Weight_cat_quan, Weight_cat_quan =="[1.5e+03,2.51e+03]","<10th percentile (< 2511 g)" ),
   Weight_cat_quan  = replace( Weight_cat_quan, Weight_cat_quan =="(2.51e+03,3.78e+03]","10th–90th percentile (2511 - 3780 g)" ),
   Weight_cat_quan  = replace( Weight_cat_quan, Weight_cat_quan =="(3.78e+03,5.58e+03]","> 90th percentile (>3780 g)" ),
   Weight_cat_quan = factor(Weight_cat_quan, levels = c("> 90th percentile (>3780 g)", 
                                                        "10th–90th percentile (2511 - 3780 g)",
                                                        "<10th percentile (< 2511 g)")),
   year = as.factor(year),
   boy = as.factor(boy),
   stillborn = as.factor(stillborn),
   city = as.factor(city),
   insurance = as.factor(insurance),
   married = as.factor(married),
   matbody2 = as.factor(matbody2),
   occupation2 = as.factor(occupation2),
   matheight2  = as.factor(matheight2 ),
   malnutrition2 = as.factor(malnutrition2),
   Gest_group = factor(Gest_group, levels=c("normal","early")),
   parity = factor(parity, levels=c("1","2","3",">=4")),
   city = factor(city, levels=c("1","0")),
   married = factor(married, levels=c("1","0")),
   boy = factor(boy, levels=c("1","0")),
   birth_season = factor( birth_season, levels=c("Spring","Summer","Fall","Winter")),
   parity = factor(parity, levels = c("1","2","3",">=4")),
   matbody2 = factor(matbody2, levels=c("2","1","3")),
   matheight2 = factor(matheight2, levels=c("2","1","3")),
   malnutrition2 = factor(malnutrition2, levels=c("0","1")),
   occupation2 = factor(occupation2, levels=c("4","1","2","3","5","6","7"))
  )

```

# Missings

```{r TableMissing, echo=FALSE,message=FALSE}
function_missing() %>%
  as_tibble(rownames="Variable") %>%
  arrange(value) %>%
  kbl(col.names =c("Variable","Prozent Missings")) %>%
  kable_paper("hover", full_width = F)
```

Anzahl alle Daten
```{r Tablefull6, echo=FALSE,message=FALSE}
nrow(databern)
```

Zusätzlich ohne Zwillinge

```{r Tablefull2, echo=FALSE,message=FALSE}
nrow( databern%>%
      filter(multiple==0))
```

<!-- Zusätzlich ohne stillborn -->

<!-- ```{r Tablefull3, echo=FALSE} -->
<!-- nrow(function_missing_red() %>% -->
<!--        filter(multiple==0) %>% -->
<!--      filter(stillborn==0)) -->
<!-- ``` -->

Zusätzlich ohne Gewichte < 1500 g

```{r Tablefull4, echo=FALSE,message=FALSE}
nrow(databern%>%
       filter(multiple==0) %>%
       filter(!(weight < 1500)))
```

Zusätzlich ohne Alter der Mutter > 50 Jahre und < 14 Jahre

```{r Tablefull5, echo=FALSE,message=FALSE}
nrow(databern %>%
       filter(multiple==0) %>%
       filter(!(weight < 1500)) %>%
       filter(!(matage > 50))%>%
       filter(!(matage <14)))
```

# Table

* Ohne Zwillnge, ohne Gewichte < 1500 g, ohne Alter der Mutter > 50 Jahre oder < 14 Jahre
* 1901 ganz raus
* 1911 keine Angaben zu city

```{r Tablefull, echo=FALSE,results = "asis",message=FALSE}
tab1 <- tableby(year ~ weight + Weight_cat_quan+ boy + parity + matage+stillborn+ Gest_group+city+insurance+married
                + Gest_group+birth_isoweek+birth_month+matheight2+malnutrition2+matbody2+
                  occupation2+agemenarche, data=used.data,test=FALSE)
summary(tab1)
```

# Plots

```{r PlotDist, echo=FALSE, warning=FALSE, fig.height = 60, fig.width = 20,message=FALSE}
function_plot()
```

# Quantile Regression
## 1912 - 1922

Nur die Daten von 1912 bis 1922. Die Ergebnisse wurden für alle Variablen gegenseitig adjustiert. Recht die Ergebnisse der Quantilen Regression und links zum Vergleich die
lineare Regression (diese sollte, wenn normalverteilt, die Ergebnissem vom Quantile 0.5 widerspiegeln). CIs sind mit Bootstrapping berechnet.

```{r PlotReg1912, echo=FALSE, warning=FALSE, fig.height = 60, fig.width = 15,message=FALSE}
function_quantile_regression_1912()
```

## 1880 - 1900

Nur die Daten von 1880 bis 1900. Die Ergebnisse wurden für alle Variablen gegenseitig adjustiert. Recht die Ergebnisse der Quantilen Regression und links zum Vergleich die
lineare Regression (diese sollte, wenn normalverteilt, die Ergebnissem vom Quantile 0.5 widerspiegeln). CIs sind mit Bootstrapping berechnet.

```{r PlotReg1880, echo=FALSE, warning=FALSE, fig.height = 80, fig.width = 15,message=FALSE}
function_quantile_regression_1880()
```


## Vergleich Spanische Grippe
1917
```{r PlotReg1917, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_quantile_regression_years(Year=1917)
```
1918
```{r PlotReg1918, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_quantile_regression_years(Year=1918)
```
1919
```{r PlotReg1919, echo=FALSE, warning=FALSE, fig.height = 10, fig.width =10,message=FALSE}
function_quantile_regression_years(Year=1919)
```
1920
```{r PlotReg1920, echo=FALSE, warning=FALSE, fig.height = 10, fig.width =10,message=FALSE}
function_quantile_regression_years(Year=1920)
```

# Logistische Regression
## Stillborn
```{r Plotstillborn, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_stillborn()
```
1917
```{r Plotstillborn1917, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_stillborn_year(Year=1917)
```
1918
```{r Plotstillborn1918, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_stillborn_year(Year=1918)
```
1919
```{r Plotstillborn1919, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_stillborn_year(Year=1919)
```
1920
```{r Plotstillborn1920, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_stillborn_year(Year=1920)
```

## Gestational Age
```{r PlotsGestage, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_gestage()
```
1917
```{r PlotsGestage1917, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_gastage_year(Year=1917)
```
1918
```{r PlotsGestage1918, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_gastage_year(Year=1918)
```
1919
```{r PlotsGestage1919, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_gastage_year(Year=1919)
```
1920
```{r PlotsGestage1920, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 10,message=FALSE}
function_regression_gastage_year(Year=1920)
```
