---
title: "Birthweights Descriptive Analysis"
author: "Katarina Matthes"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    code_folding: show
    self_contained: true
    highlight: pygments
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r global_options, include=FALSE,message=FALSE}
data_plot <- read.csv(paste0("../data_raw/",data.bern), header=TRUE, sep=";") %>%
    filter(!year=="1901") %>%
    filter(!year=="1902") %>%
    filter(!year=="1903") %>%
    filter(!year=="1911") %>%
    filter(!year=="1912") %>%
    filter(!year=="1913") %>%
    filter(!year=="1923") %>%
  filter(multiple==0) %>%
    filter(!(gest <30)) %>%
  filter(!(weight < 1500)) %>%
  filter(!(matage > 50))  %>%
   filter(!(matage < 14)) %>% 
    select(year, insurance, matage, married,parity, gest, birthday2, boy, stillborn, multiple, weight, gestdummy2, matheight2, matbody2,
           malnutrition2, occupation2, agemenarche, coordinates, distance, city)%>%
    mutate(coordinates=ifelse(coordinates=="", NA, coordinates),
           birth_isoweek = isoweek(dmy(birthday2)),
           birth_month = month(dmy(birthday2)),
           birth_weekday = wday(dmy(birthday2),week_start = 1),
           birth_weekday2 = weekdays(dmy(birthday2)),
           birth_season = as.character(cut(birth_month, breaks=c(1,3,6,9,12),include.lowest = TRUE)),
           birth_season  = replace(birth_season, birth_season=="[1,3]", "Winter" ),
           birth_season  = replace(birth_season, birth_season=="(3,6]", "Spring" ),
           birth_season  = replace(birth_season, birth_season=="(6,9]", "Summer" ),
           birth_season  = replace(birth_season, birth_season=="(9,12]", "Fall" ),
           birth_season = as.factor(birth_season),
           birth_season = factor(birth_season, levels = c("Spring","Summer","Fall","Winter")),
           Gest_group = floor(gest),
           # Gest_group  = replace(Gest_group ,Gest_group>42, "late" ),
           Gest_group  = replace(Gest_group ,Gest_group>=38, "normal" ),
           Gest_group  = replace(Gest_group ,Gest_group<38, "early" ),
           Gest_group = as.factor(Gest_group),
           parity = ifelse(parity>3, 4, parity),
           parity = as.factor(parity),
           parity = ifelse(parity=="4",">=4", parity),
           parity = factor(parity, levels = c("1","2","3",">=4")),
           boy = as.factor(boy),
         stillborn = as.factor(stillborn),
         city = as.factor(city),
         insurance = as.factor(insurance),
         married = as.factor(married),
         matbody2 = as.factor(matbody2),
         occupation2 = as.factor(occupation2),
         matheight2  = as.factor(matheight2 ),
         malnutrition2 = as.factor(malnutrition2),
         Gest_group = factor(Gest_group, levels=c("normal","early")),
         parity = factor(parity, levels=c("1","2","3",">=4")),
         city = factor(city, levels=c("1","0")),
         married = factor(married, levels=c("1","0")),
         boy = factor(boy, levels=c("1","0")),
         birth_season = factor( birth_season, levels=c("Spring","Summer","Fall","Winter")),
         parity = factor(parity, levels = c("1","2","3",">=4")),
         matbody2 = factor(matbody2, levels=c("2","1","3")),
         matheight2 = factor(matheight2, levels=c("2","1","3")),
         malnutrition2 = factor(malnutrition2, levels=c("0","1")),
         occupation2 = factor(occupation2, levels=c("4","1","2","3","5","6","7")))
         

```

# Table
```{r Tablefull, echo=FALSE,results = "asis",message=FALSE}
tab1 <- tableby(year ~ weight + boy + parity + matage+stillborn+ Gest_group+city+insurance+married
                + Gest_group+matheight2+malnutrition2+matbody2+
                  occupation2+agemenarche, data=data_plot,test=FALSE)
summary(tab1)

# tab_des <- summary(tab1,text=TRUE)
# tab_des <- as.data.frame(tab_des)
# table2excel(tab_des, file = "output/Table1.xlsx")
 

```

# Plots
```{r , echo=FALSE, warning=FALSE, fig.height = 90, fig.width = 15,message=FALSE}
function_plot()
```

# Density
```{r, echo=FALSE, warning=FALSE, fig.height = 10, fig.width = 8,message=FALSE}
function_density()
```


# Flu Cases

A) Number of cases for each calender week
B) Roll sum for 12 weeks (e.g. 1918_w52 shows the sum from 1918_w41 to 1918_w52,  1919_w1 shows the sum from 1918_w42 to 1919_w1). If a women 
has for example one of the trimester from  1918_w41 to 1918_w52, she was exposed during 12 weeks to 75'078 cases, which leads to
C) a flu intensity for roll sum of 12 weeks: 0.92
D) Rolls sum of 16 weeks (if third trimester is longer)
E) Flu intensity for roll sum of 16 weeks
F) Rolls sum of 4 weeks (if third trimester is only 4 weeks long)
G) Flu intensity for roll sum of 4 weeks 


```{r, echo=FALSE, warning=FALSE, fig.height = 25, fig.width = 8,message=FALSE}
function_flu_plot()
```